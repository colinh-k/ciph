# `ciph`
## Description and notes
- A C++ utility and header-only library for enciphering and deciphering files using the [AES algorithm](https://csrc.nist.gov/csrc/media/publications/fips/197/final/documents/fips-197.pdf) and generating cryptographic key files.
- Files may be enciphered and deciphered using a sub-range of bytes, instead of the entire file. The same sub-range should be used when enciphering and deciphering. The program will determine the amount of padding added in the enciphering phase and appropriately adjust the sub-range when deciphering using the same range.
- Files may be enciphered and deciphered using a 128, 192, or 256 bit key. Appropriate key files are generated using the `keygen` operation. Keys are randomly initialized using `arc4random`.
- If the last byte given in a range is greater than the size of the input file, the operation is performed to the end of the file instead.
- An `encipher` operation always adds padding bytes to align with the 16-byte block size of the AES specification. So, any `decipher` operation must be performed on a file generated by an `encipher` operation to ensure padding is removed appropriately.

## Build
- Use `make ciph` to build the implementation found in `src/ciph.cpp`. The executable will be stored in `build/cxx/bin` as `ciph`.

## Command-line utility usage
```
Usage: ciph [-h help] [-i input-file] [-o output-file] [-k key-file] [-s key-size] [-r range range] operation
Positional arguments:
        operation       specify the type of operation to perform {encipher, decipher, or keygen}

Optional arguments:
        -h, --help      display this help message
        -i, --input-file        the input filename required for enciphering or deciphering (must exist)
        -o, --output-file       the output filename required for enciphering or deciphering (overwritten if already exists)
        -k, --key-file  the key filename
        -s, --key-size  the key size in bits (must be compliant with AES) {128, 192, 256}
        -r, --range     range for operation {first-byte last-byte}
```

## Testing
- The core cryptographic operations are found in `include/aes.h`. These functions implement the AES block cipher. Tests for these functions can be found in `test/test_aes.hpp`.
- The tests are copied from the Example Vectors section in Appendix C of [the AES specification](https://csrc.nist.gov/csrc/media/publications/fips/197/final/documents/fips-197.pdf). They check the output of the encipher and decipher operations with a piece of plaintext and every required size of key, i.e., 128, 192, and 256 bit keys.

## Examples
- Generate a 128-bit key file:
  - `ciph keygen -k key128 -s 128`
  - This operation creates a new file `key128.ciphkey` with 128 bits of randomly initialized key data.
  - Note: the size of the key is stored in the file and does not need to be supplied to other operations.

- Encipher `file.txt` completely using the 128-bit key generated above, and store the ciphertext in `enciphered_file.txt`:
  - `ciph encipher -i file.txt -o enciphered_file.txt -k key128.ciphkey`

- Decipher `enciphered_file.txt` using the 128-bit key generated above, and store the deciphered text in `deciphered_file.txt`:
  - `ciph decipher -i enciphered_file.txt -o deciphered_file.txt -k key128.ciphkey`

- Encipher `file.txt` from byte 15 to byte 42 using the 128-bit key generated above:
  - `ciph encipher -i file.txt -o enciphered_file.txt -k key128.ciphkey`

- Decipher `enciphered_file.txt` from byte 15 to byte 42 of the original file using the 128-bit key generated above, and store the deciphered text in `deciphered_file.txt`:
  - `ciph decipher -i enciphered_file.txt -o deciphered_file.txt -k key128.ciphkey`

## Limitations
- It may not be possible to specify subranges in very large files, since the byte ranges must fit in `size_t` variables.